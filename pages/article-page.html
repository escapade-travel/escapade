<dom-module id="article-page">
    <template>

        <iron-ajax id="getdata"
                auto
                url="/data/articles.json"
                method="GET"
                handle-as="json"
                on-response="handleResponse"
                debounce-duration="300"></iron-ajax>
                
    <!-- Navigation -->
    <nav-element></nav-element>
    
    <!-- Page Header -->
<!-- Set your background image for this header on the line below. -->
<header class="intro-header post-page" id="image">
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <div class="row">
                <div class="post-heading">

                    <h1 id="title"></h1>
                    <h2 class="subheading" id="subtitle"></h2>
                </div>
                <div class="post-tags">
                <template is="dom-repeat" items="{{article.tags}}">
                    <span class="btn btn-sm btn-info">{{item}}</span>
                </template>
                </div>
                <div id="content"></div>
            </div>
            <div class="row">
                <div class="actions text-center">
                    <div id="book-now" class="">
                        <a href="#/booking" class="btn btn-lg btn-primary selected fullwidth">立即预订</a>
                    </div>
                </div>
            </div>
        </div>
        <hr>
    </div>
</article>
<section class="container">
    <div class="no-padding col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
        <div class="row">
            <!-- Related reading -->
            <related-element article-id="{{id}}" articles="{{articles}}"></related-element>
        </div>
    </div>

    <div class="col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
        <div class="row">
            <div class="actions text-center">
                <div class="">
                    <a href="#/themes" class="btn btn-lg btn-info fullwidth">返回列表</a>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Footer -->
    <footer-element></footer-element>
    </template>
    <script>
        Polymer({
            is: "article-page",
            properties: {
                id: {
                    type: String
                },
                article: {
                    type: Object,
                    value: {
                        content: [
                            {
                                type: 'p',
                                text: '在日本北陆的中心有一片黄金的沼泽，这里是全日本98%的金箔产地，被人们盛赞为“充满文化、历史与自然之美的地方”，是世界10大最佳旅行目的地之一。'
                            },
                            {
                                type: 'p',
                                text: '时至今日，大街小巷中仍留存着古老的匠人印记，九谷烧，加贺友禅，茶道，和菓子，漆器……等等。不过当人们说起金泽，兼六园，金泽21世纪美术馆，铃木大拙纪念馆以及玉泉院都是不可错过的美景。作为北陆地区的首府，这里也是海鲜和各种美食的聚集地，在近江市场走一走，一定是饿着肚子进去，挺着肚子出来的。'
                            },
                            {
                                type: 'p',
                                text: '如今，随着北陆新干线的正式开通，这片曾经的北陆秘境终于对我们揭开了面纱。'
                            },
                            {
                                type: 'img',
                                src: '../../assets/img/post-1.jpg',
                                alt: ''
                            },
                            {
                                type: 'heading',
                                text: '亮点'
                            },
                            {
                                type: 'p',
                                text: '这一条探访金泽的线路由游学日本6年并且专注吃喝玩乐的资深专家Zulu打造。'
                            },
                            {
                                type: 'p',
                                text: 'Zulu 说'
                            },
                            {
                                type: 'blockquote',
                                text: '比起京都和奈良，北陆金泽更让我觉得是日本的原点所在之处。并不过于发达的旅游业，使得很多原生态的东西更好地，以真正当地人生活于其中的方式呈现出来，十分真实。 我还记得第一次去金泽的时候，从温泉旅馆的窗户里看到日本海的风雪，旅馆的老阿姨告诉我，这个就叫做“吹雪”。'
                            },
                            {
                                type: 'p',
                                text: '凛冽的自然和温暖的人情，应该就是日本的真实模样吧。'
                            },
                        ],
                        tags: ['历史', '艺术']
                    }
                }
            },
            handleResponse: function(data) {
                this.articles = data.detail.response.result;
                
                var header = this.getHeader(this.id);
                if(header) {
                    this.$.title.innerHTML = header.title;
                    this.$.subtitle.innerHTML = header.description;
                    this.$.image.style.backgroundImage = "url('"+ header.image +"')";
                    this.$.content.innerHTML = this.getContent(this.article.content);
                } else {
                    document.querySelector('app-router').go('/home');
                }
                
            },
            getHeader: function(id) {
                for(var i=0; i<this.articles.length; i++) {
                    if(this.articles[i].id == id) {
                        return this.articles[i];
                    }
                }
            },
            getContent: function(contents) {
                var content = "";
                for(var i=0; i<contents.length; i++) {
                    switch(contents[i].type) {
                        case 'p':
                            content += "<p>" + contents[i].text + "</p>";
                        break;
                        
                        case 'a':
                        break;
                        
                        case 'heading':
                            content += "<h2 class='section-heading'>" + contents[i].text + "</h2>";
                        break;
                        
                        case 'img':
                            content += "<img class='img-responsive' src='" + contents[i].src + "' alt='" + contents[i].alt + "'>";
                        break;
                        
                        case 'blockquote':
                            content += "<blockquote>" +  contents[i].text + "</blockquote>";
                        break;
                        
                        default:
                        break;                        
                    }
                }
                
                return content;
            },
            attached: function() {
                window.scrollTo(0, 0);
            }
        });
    </script>
</dom-module>